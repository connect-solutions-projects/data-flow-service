<div class="content-page">
  <h1>Execução do DataFlow Fora do Docker</h1>

  <blockquote>Este fluxo é opcional e exige configuração manual de todas as dependências. O modo suportado oficialmente é via Docker Compose.</blockquote>

  <h2>1. Pré-requisitos</h2>
  <ol>
    <li><strong>.NET 9 SDK</strong> instalado.</li>
    <li>Dependências locais:
      <ul>
        <li>PostgreSQL 15+</li>
        <li>Redis 7+</li>
        <li>RabbitMQ 3.12+</li>
      </ul>
    </li>
    <li>Ferramentas opcionais:
      <ul>
        <li><code>dotnet-ef</code> para migrations.</li>
        <li>Node.js (diagramas).</li>
      </ul>
    </li>
  </ol>

  <h2>2. Provisionar dependências</h2>
  <ul>
    <li><strong>PostgreSQL:</strong> crie banco (ex.: <code>dataflow</code>), usuário e senha.</li>
    <li><strong>Redis:</strong> iniciar serviço (<code>redis-server</code>).</li>
    <li><strong>RabbitMQ:</strong> iniciar (<code>rabbitmq-service start</code>) e habilitar UI se desejado.</li>
  </ul>

  <h2>3. Variáveis de ambiente</h2>
  <pre><code>$env:ConnectionStrings__Postgres = "Host=localhost;Port=5432;Database=dataflow;Username=dataflow_admin;Password=dataflow_admin"
$env:ConnectionStrings__Redis = "localhost:6379"
$env:Rabbit__Connection = "amqp://guest:guest@localhost:5672/"
$env:RABBIT__HOST = "localhost"
$env:REDIS__HOST = "localhost"
$env:POSTGRES__HOST = "localhost"</code></pre>
  <p>Opcional: criar <code>appsettings.Development.local.json</code> com essas configurações (não versionar).</p>

  <h2>4. Aplicar migrations (Postgres)</h2>
  <pre><code>cd src\apps\DataFlow.Api
dotnet ef database update</code></pre>
  <p>Repita se necessário para outros projetos que utilizam o contexto.</p>

  <h2>5. Executar os serviços</h2>
  <h3>API</h3>
  <pre><code>cd src\apps\DataFlow.Api
dotnet run --project DataFlow.Api.csproj</code></pre>
  <p>Disponível em <code>https://localhost:5001</code> (ajuste <code>ASPNETCORE_URLS</code> se necessário).</p>

  <h3>Worker</h3>
  <pre><code>cd src\apps\DataFlow.Worker
dotnet run --project DataFlow.Worker.csproj</code></pre>

  <h3>Reporting Service</h3>
  <pre><code>cd src\apps\DataFlow.ReportingService
dotnet run --project DataFlow.ReportingService.csproj</code></pre>
  <p>Configure <code>PROMETHEUS_URL</code> e <code>GRAFANA_URL</code> para apontar para os serviços em execução.</p>

  <h2>6. Observabilidade</h2>
  <ul>
    <li>Instalar Prometheus/Grafana localmente ou</li>
    <li>Executar somente o stack de observabilidade via Docker Compose:
      <pre><code>docker compose up -d otel-collector prometheus grafana grafana-renderer</code></pre>
    </li>
  </ul>

  <h2>7. Ajuste de endpoints</h2>
  <p>Sem o Nginx, acesse Swagger diretamente nas portas de desenvolvimento (<code>https://localhost:&lt;porta&gt;/swagger</code>). Configure proxy ou atualize URLs conforme necessidade.</p>

  <h2>8. Scripts úteis</h2>
  <ul>
    <li><code>scripts/ingestion/gera-parametros.bat</code> — continua válido.</li>
    <li>Use <code>curl</code> apontando para <code>https://localhost:5001</code>.</li>
  </ul>

  <h2>9. Limitações</h2>
  <ul>
    <li>Dockerfiles contêm ajustes não replicados neste modo.</li>
    <li>Gerenciamento de certificados HTTPS fica por sua conta (<code>dotnet dev-certs https --trust</code>).</li>
    <li>Mantenha o Docker Compose como referência oficial.</li>
  </ul>
</div>

